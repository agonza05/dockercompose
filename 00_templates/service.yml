services:
    common:
        env_file:
            - ${PWD}/.env.container
        restart: unless-stopped
        cpus: 0.5
        mem_limit: 512m
        labels:
            # Logging configuration
            dev.dozzle.group: ${COMPOSE_PROJECT_NAME}
        logging:
            driver: json-file
            options:
                max-size: "1m"
                max-file: "1"
                tag: "{{.Name}}"

    private:
        extends:
            service: common
        networks:
            - private

    proxy:
        extends:
            service: common
        networks:
            - public
        labels:
            # Traefik configuration
            - traefik.enable=true
            - traefik.http.middlewares.${COMPOSE_PROJECT_NAME}-auth.basicauth.users=${USERNAME}:${HASHED_PASSWORD}
            - traefik.http.routers.${COMPOSE_PROJECT_NAME}-https.entrypoints=websecure
            - traefik.http.routers.${COMPOSE_PROJECT_NAME}-https.rule=Host(`${COMPOSE_PROJECT_NAME}.${BASE_DOMAIN}`)
            - traefik.http.routers.${COMPOSE_PROJECT_NAME}-https.middlewares=${COMPOSE_PROJECT_NAME}-auth
